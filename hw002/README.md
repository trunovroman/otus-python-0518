# Анализатор логов веб-сервера
Анилизирует логи веб-сервера nginx, собирает статистику о времени обработки URL`ов, формирует отчет. Для работы скрипта требуется Python 3+.

## Запуск скрипта

```
python3 log_analyzer.py [--config CONFIG]
```
`CONFIG` — путь до конфигурационного файла. Ни один из параметров не является обязательным, в этом случае будет взято знаение по умолчанию (см. переменную config в log_analyzer.py)

## Структура конфигурационного файла

```
{
    "REPORT_SIZE": 1000,
    "REPORT_DIR": "./reports",
    "LOG_DIR": "./log",
    "PATTERN_FILE_PATH": "./report.html",
    "ERROR_PERCENT": 10,
    "ROUND_PLACES": 3,
    "LOGGING_LEVEL": "INFO",
    "LOG_FILE_MASK": "(nginx-access-ui.log-(?P<year>\d{4})(?P<month>\d{2})(?P<day>\d{2})(\.gz)?$)",
    "LOGGER_FILE_PATH": ""
}
```

* `REPORT_SIZE` — (int) количество строк в файле отчета. В отчет попадает REPORT_SIZE URL'ов с наибольшим суммарным временем обработки.
* `REPORT_DIR` — папка, в которую будут складываться готовые отчеты. Если папка не существует, то она будет создана по результатам работы скрипта. Чтобы в отчете работала сортировка по столбцами, нужно в папку с отчетами положить библиотеку `jquery.tablesorter.min.js`.
* `LOG_DIR` — папка с исходными логами веб-сервера.
* `PATTERN_FILE_PATH` — полный путь до файла с шаблоном отчета.
* `ERROR_PERCENT` — (int) процент ошибок парсинга логов, при привышении которого скрипт прекращает работу и выходит с сообщением об ошибке.
* `ROUND_PLACES` — (int) количество знаков после запятой, до которого округлять все дробные значения в отчете.
* `LOG_LEVEL` — уровень логирования. Доступны значения INFO, ERROR, CRITICAL.
* `LOG_FILE_MASK` — регулярное выражение для парсинга имени файлов лога. Должны присутствовать параметры year, month, day. Которые будут использованы для формирования отчета по шаблону `report-<year><month><day>.html`.
* `LOGGER_FILE_PATH` — полный путь до файла с логами скрипта. Если значение данного атрибута не задано или пустое, то лог работы скрипта выводится в stdout.

## Запуск тестов
Тесты лежат в папке tests. Тесты запускаются из корневой папки скрипта командой:
```
python3 -m unittest tests/test_*.py
```
* `test_calculation.py` — проверяется расчет аналитических показателей отчета.